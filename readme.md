## Как собирать эту штуку

### 1. Nexus OSS

Необходимо поднять контейнер с нексусом:

```shell
$ docker-compose up -d nexus
```

P.S. Опция `-d (detach)` означает запустить контейнер в фоне. Это нужно для того, чтобы он не упал при закрытии управляющего терминала.

Далее надо перейти по адресу http://localhost:8081 для дальнейшей настройки репозиториев.

При первом запуске нексус потребует ввести автоматически сгенерированный пароль, который можно найти в файле `nexus/data/admin.password`.

Для корректной работы необходимо разрешить анонимный доступ. Это делается при первом входе.

P.S. Директория `nexus/data` содержит hosted-репозитории, а также все настройки нексуса.

Рекомендуется в дальнейшем сменить пароль на `admin123` для того, чтобы собранные модули системы смогли попасть в репозиторий (больше об этом чуть позже).

### 2. Настройка репозиториев

Для настройки нексуса надо перейти на вкладку *Server administration and configuration* (шестеренка. Если ее нет, надо сначала войти как администратор). Далее на вкладку *Repository* &rightarrow; *Repositories*. Жмем кнопку *create repository* для создания нового репозитория. Всего нужно сделать 2 репозитория со следующими параметрами:

**Создание прокси для 68 датацента:**

- Recipe: maven2 (proxy)
- Name: `c86-proxy`
- Maven2:
  - Version policy: `Mixed`
- Proxy:
  - Remote storage: https://nexus.c68.spacecorp.ru/repository/cuba-group

P.S. Имя `c68-proxy` ни на что не влияет и нужно только для того, чтобы добавить этот репозиторий в группу. Поэтому это имя может быть произвольным.

**Создание общей группы:**

- Recipe: maven2 (group)
- Name: `cuba-group` (P.S. здесь имя уже важно)
- Maven2:
  - Version policy: `Mixed`
- Group (Members):
  - maven-releases
  - maven-snapshots
  - c68-proxy

### 3. Gradle part `I`. Dependency journey

Следующим шагом будет сборка и подготовка модулей, от которых зависит основной проект (MOBDEKBKP).

**Вариант 1. Через имеющиеся wrapper-ы**

Для выполнения задач использовать имеющиеся скрипты-wrapper-ы:

`gradlew` (Unix) / `gradlew.bat` (Windows)

**Но** перед сборкой необходимо поднять контейнер с базой данных командой

```shell
$ docker-compose up -d database
```

P.S. Данный вариант не пробовал, но работать должно.

**Вариант 2. Через ещё один контейнер**

Поднимаем контейнер с нужной версией грейдла командой:

```shell
$ docker-compose up builder
```

P.S. Данная команда должна поднять зависимый контейнер с базой данных, поэтому о базе можно не беспокоиться.

Далее, чтобы попасть в контейнер, запускаем оболочку:

```shell
$ docker-compose run builder bash
```

Внутри контейнера для выполнения задач (task-ов) рекомендуется использовать gradle непосредственно.

**Порядок выполнения задач (Общая часть)**

Coming soon...

### 4. Gradle part `II`. MOBDEKBKP

Сборка основного проекта проходит по такой же схеме:

```shell
$ cd MOBDEKBKP
$ gradle assemble createDb updateDb
```

За исключением того, что в конце происходит деплой и запуск приложения через Tomcat:

```shell
$ gradle deploy setupTomcat start
```

После этого веб-интерфейс приложения должен быть доступен по адресу http://localhost:8080/app
