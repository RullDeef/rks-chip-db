# 	Дополнение функционала фрейма карточки Типономинала.

​	Фрейм "Карточка Типономинала" (далее - ФКТ) создан для унификации отображения сведений об Изделии ЭКБ в разных частях приложения. В основе его работы лежит декомпозиция отображаемых данных и распределение функционала по формированию этих данных по отдельным, никак не связанным между собой фреймам "нижнего уровня". Поскольку ФКТ может быть встроен в другие фреймы и оконные формы - он реализует интерфейс `TyponominalFrame`. Отсюда следует, что все фреймы нижнего уровня для корректной работы также должны реализовывать интерфейс `TyponominalFrame`, подробнее об этом см. `frames-wiki.md`. 

## 	Использование
​	Для того, чтобы воспользоваться фреймом, помимо его непосредственного добавления на оконную форму через описание `XML` или через `Cuba Studio`
``` xaml
<frame id="cardFrame"
       height="100%"
       screen="tn-card-frame"/>
```
необходимо в контроллере формы задать для ФКТ ряд входных параметров, а также, возможно, в код самого ФКТ. Отсутствие одного из необходимых параметров повлечёт за собой неработоспособность ФКТ, поэтому рекомендуется дочитать данный документ до конца. Существующий вариант ФКТ может вызываться в двух ситуациях - с изначальным "знанием" об отображаемом Изделии ЭКБ и без него. Рассмотрим оба этих варианта подробнее. Модификация фрейма будет рассмотрена позднее.

### Инициализация с изделием ЭКБ
​	Такая инициализация предполагается, когда необходимо единоразово показать сведения об Изделии ЭКБ. При такой инициализации необходимо передать во фрейм собственно отображаемый типономинал в параметре `TnCardFrame.TN_PARAM_NAME`
``` java
Map<String, Object> frameparams = new HashMap<>();
frameparams.put(TnCardFrame.TN_PARAM_NAME, tn);
frameparams.put(TnCardFrame.OPTION_PARAM, TnCardFrame.ALL_TABS);
cardFrame.reinit(frameparams);
```
Для корректной передачи названий параметров рекомендуется использование определённых внутра ФКТ констант. 

### Инициализация без изделия ЭКБ
​	Такая инициализация предполагается, когда необходимо использовать ФКТ, как встроенный на композитную форму фрейм. В этом случае необходимо передать во фрейм строковое значение, которое будет отображаться на пустом ФКТ и всех его внутренних компонентах в параметре `TnCardFrame.NO_INIT_TN_LABEL`. 
``` java
Map<String, Object> frameparams = new HashMap<>();
frameparams.put(TnCardFrame.NO_INIT_TN_LABEL, getMessage("noDsLabel"));
frameparams.put(TnCardFrame.OPTION_PARAM, TnCardFrame.ALL_TABS);
cardFrame.reinit(frameparams);
```
Логика работы фрейма построена таким образом, что рассмотренные варианты являются взаимоисключающими, поэтому передавать их оба не имеет смысла (фактически внутри работает жёсткое ветвление `if-else` по условию наличия `TnCardFrame.NO_INIT_TN_LABEL` в передаваемых параметрах). В случае, если ни один из вышеуказанных параметров не будет найден - ФКТ сгенерирует исключение с текстом `"Error loading TnCard. One of mandatory parameters missing"`. 

### Опции загрузки
​	Опции загрузки фрейма `TnCardFrame.OPTION_PARAM` являются обязательным параметром и представляют собой самую жёстко запрограммированную часть кода. Опции загрузки не зависят от передачи во фрейм изделия ЭКБ и указывают, какие табы и фреймы должны быть загружены. Значения по умолчанию также нет, параметр необходимо передавать явно. Один из вариантов значений параметра может быть `TnCardFrame.ALL_TABS`, что будет означать, что для отображения будут загружены все внутренние фреймы ФКТ.  

### Изменение фрейма и опций загрузки
​	Структура и поведение ФКТ в этой части будут показаны на примере опции `TnCardFrame.DEV_LIST`. Опция `TnCardFrame.ALL_TABS` работает чуть проще, а прочие опции должны работать аналогично. Добавлять новые опции необходимо согласно приведённой структуры. Вкладки и фреймы, которые необходимо отображать находятся в соответствующих массивах. Названия вкладок находятся в строковом массиве, который объявлен и заполняется в статической секции
```java
    private String[] devListTabs = { "fBasicInfo", "tabParameters", "tabPurchParams" };
```
а массив ссылок на фреймы `TyponominalFrame[] devListFrames` объявлен в статической секции, и присваивается в методе `public void reinit(Map<String, Object> params)`
``` java
public void reinit(Map<String, Object> params) {
    super.init(params);
    devListFrames = new TyponominalFrame[] { fHierarchy, fBasicInfo, fParametersMain, fPurchaseParameters };
    ...
}
```
При загрузке ФКТ выгружает из параметра `TnCardFrame.OPTION_PARAM` значение, и в нужные моменты будет передавать его в метод `private void showPickedFrames(boolean show)`. В него и необходимо добавить поведение для создаваемых опций. Внутри оператора `switch (option)` необходимо добавить аналогичный кейс для вновь создаваемой опции

``` java
case DEV_LIST:
    showTabs(allTabs, false);
    if (show)
        showTabs(devListTabs, true);
    changeFramesState(devListFrames, show);
    break;
```

​	Данный код означает следующее: необходимо отключить все табы на ФКТ, и затем показать только те табы и фреймы, которые были переданы в соответствующих массивах в методы `showTabs()` и `changeFrameState()`. 